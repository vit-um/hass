# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—î—é —Ç–∞ –ø—Ä–æ–≤—ñ—Ç—Ä—é–≤–∞–Ω–Ω—è–º
fan_auto:
  automation:
  - id: ventilation_bath_on
    alias: –ü—Ä–æ–≤–µ—Ç—Ä–∏—Ç—å –≤–∞–Ω–Ω—É –µ—Å–ª–∏ –≤–ª–∞–∂–Ω–æ
    initial_state: true
    trigger:
    - platform: state
      entity_id: switch.sonoff_1000ce8956
      from: 'on'
      to: 'off'
    - platform: state
      entity_id: switch.sonoff_1000ce82c8
      from: unavailable
      to: 'off'
    condition: '{{ (states.sensor.bath_humidity.state | int ) - (states.sensor.sonoff_1000bed42e_humidity.state
      | int) > 10}}'
    action:
    - service: switch.turn_on
      data:
        entity_id: switch.sonoff_1000ce82c8
    - service: notify.telegram_gr
      data:
        title: '*–í—ã—Ç—è–∂–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞*'
        message: 'üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å –≤ –≤–∞–Ω–Ω–æ–π: {{ states(''sensor.bath_humidity'') }}%.

          üí¶ –î–µ–ª—å—Ç–∞ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ —Å –∑–∞–ª–æ–º —Å–æ—Å—Ç–∞–≤–∏–ª–∞: {{ (states.sensor.bath_humidity.state
          | int ) - (states.sensor.sonoff_1000bed42e_humidity.state | int) }}%'
    mode: single

  - id: ventilation_bath_off
    alias: –í—ã–∫–ª—é—á–∏—Ç—å –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—é –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
    trigger:
    - platform: template
      value_template: '{{ (states.sensor.bath_humidity.state | int ) - (states.sensor.sonoff_1000bed42e_humidity.state
        | int) < 10}}'
    condition:
    - condition: state
      entity_id: switch.sonoff_1000ce82c8
      state: 'on'
    action:
    - service: switch.turn_off
      data:
        entity_id: switch.sonoff_1000ce82c8
    - service: notify.telegram_gr
      data:
        title: '*–í—ã—Ç—è–∂–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞*'
        message: 'üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å –≤ –≤–∞–Ω–Ω–æ–π –≤–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: {{ states(''sensor.bath_humidity'')
          }}%.

          üí¶ –î–µ–ª—å—Ç–∞ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ —Å –∑–∞–ª–æ–º —Å–æ—Å—Ç–∞–≤–∏–ª–∞: {{ (states.sensor.bath_humidity.state
          | int ) - (states.sensor.sonoff_1000bed42e_humidity.state | int) }}%'
    mode: single

  - id: ventilation_on
    alias: –ü—Ä–æ–≤–µ—Ç—Ä–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
    initial_state: true
    trigger:
    - platform: numeric_state
      entity_id: sensor.co2_co2
      above: 1000
    condition:
    - condition: state
      entity_id: switch.sonoff_1000ce8977
      state: 'off'
    - condition: state
      entity_id: input_boolean.auto_fan_on_off
      state: 'on'
    action:
    - service: switch.turn_on
      data:
        entity_id: switch.sonoff_1000ce8977
    - service: notify.telegram_gr
      data:
        title: '*–í–∫–ª—é—á–µ–Ω–∞ –ø—Ä–∏—Ç–æ—á–Ω–∞—è –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è*'
        message: 'üéê –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∏—Å–ª–æ—Ä–æ–¥–∞. –£—Ä–æ–≤–µ–Ω—å –°–û2: {{ states(''sensor.co2_co2'')
          }} ppm.'
    mode: single

  - id: ventilation_on_if_need
    alias: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –°–û2 –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏
    initial_state: true
    trigger:
    - platform: state
      entity_id: input_boolean.auto_fan_on_off
      to: 'on'
    condition:
    - condition: state
      entity_id: switch.sonoff_1000ce8977
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.co2_co2
      above: 1000
    action:
    - service: switch.turn_on
      data:
        entity_id: switch.sonoff_1000ce8977
    - service: notify.telegram_gr
      data:
        title: '*–í–∫–ª—é—á–µ–Ω–∞ –ø—Ä–∏—Ç–æ—á–Ω–∞—è –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è*'
        message: 'üéê –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∏—Å–ª–æ—Ä–æ–¥–∞. –£—Ä–æ–≤–µ–Ω—å –°–û2: {{ states(''sensor.co2_co2'') }} ppm.'
    mode: single

  - id: ventilation_off
    alias: –í—ã–∫–ª—é—á–∏—Ç—å –ø—Ä–∏—Ç–æ—á–Ω—É—é –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—é
    initial_state: true
    trigger:
    - platform: numeric_state
      entity_id: sensor.co2_co2
      below: 900
    condition:
    - condition: state
      entity_id: switch.sonoff_1000ce8977
      state: 'on'
    action:
    - service: switch.turn_off
      data:
        entity_id: switch.sonoff_1000ce8977
    - service: notify.telegram_gr
      data:
        title: '*–ü—Ä–∏—Ç–æ—á–Ω–∞—è –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞*'
        message: 'üí® –£—Ä–æ–≤–µ–Ω—å –°–û2: {{ states(''sensor.co2_co2'') }} ppm.'
    mode: single
    
  - id: turn_on_fan_double_click
    alias: –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏–µ –Ω–∞ 40 –º–∏–Ω—É—Ç –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏
    initial_state: true
    trigger:
    - platform: state
      entity_id: sensor.mi_switch_click
      to: double
    action:
    - service: fan.turn_on
      entity_id: all
    - delay: 00:40:00
    - service: fan.turn_off
      entity_id: all
    mode: single